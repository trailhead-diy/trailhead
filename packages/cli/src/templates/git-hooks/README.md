# Smart Git Hooks

This directory contains smart git hooks generated by @trailhead/cli.

## Features

- **Smart Test Execution**: Intelligent test selection based on file changes
- **Fast-Fail Pipeline**: Sequential execution with early termination
- **Framework Agnostic**: Works with Vitest, Jest, and other test frameworks
- **Monorepo Support**: Package-aware test execution
- **Configurable**: Customizable patterns and behaviors

## Files

- TypeScript CLI commands for intelligent test execution
- `lefthook.yml` - Git hooks configuration
- `.smart-test-config.json` - Project-specific configuration

## Test Execution Logic

### ðŸ”´ High-Risk Changes (Full Test Suite)

- TypeScript/JavaScript files (`.ts`, `.tsx`, `.js`, `.jsx`)
- Configuration files (`tsconfig.json`, `package.json`, `turbo.json`)
- Test configuration files (`vitest.config.*`, `jest.config.*`)

### ðŸŸ¡ Medium-Risk Changes (Affected Package Tests)

- Changes within specific packages (monorepo only)
- Non-code files in package directories

### ðŸŸ¢ Low-Risk Changes (Skip Tests)

- Documentation files (`.md`, `README`, `CHANGELOG`)
- License and legal files
- GitHub workflows and configuration
- IDE configuration files

## Execution Order

1. **Prettier** (3s) - Format and auto-fix
2. **Linter** (5-10s) - Critical lint errors
3. **Type Check** (10-15s) - Logic and type errors
4. **Documentation** (5s) - Validation (if docs changed)
5. **Security** (1s) - Secret detection
6. **File Size** (1s) - Size validation
7. **Smart Tests** (15-90s) - Intelligent test execution

## Override Mechanisms

### Environment Variables

```bash
SKIP_TESTS=1 git commit -m "urgent hotfix"
FORCE_TESTS=1 git commit -m "critical change"
SKIP_HOOKS=1 git commit -m "emergency commit"
```

### Command Line Flags

```bash
pnpm dev-cli test-runner --skip
pnpm dev-cli test-runner --force
pnpm dev-cli test-runner --dry-run
pnpm dev-cli test-runner --verbose
```

## Configuration

Edit `.smart-test-config.json` to customize:

```json
{
  "highRiskPatterns": ["\\.(ts|tsx|js|jsx)$", "package\\.json$"],
  "skipPatterns": ["\\.md$", "README", "CHANGELOG"],
  "testCommand": "pnpm test",
  "timeout": 120
}
```

## Performance Expectations

- **Low-risk commits (60%)**: 20s - Documentation/config changes
- **Medium-risk commits (30%)**: 45s - Single package changes
- **High-risk commits (10%)**: 90s - Cross-cutting changes

## Troubleshooting

### Tests Taking Too Long

- Increase timeout in `.smart-test-config.json`
- Use `--skip` flag for urgent commits
- Check if file patterns are correctly categorized

### False Risk Detection

- Update patterns in `.smart-test-config.json`
- Use `--verbose` flag to debug file categorization
- Test with `--dry-run` before committing

### Package Detection Issues (Monorepo)

- Verify `packageMappings` in configuration
- Ensure package directories follow expected structure
- Check that test commands support `--filter` flag

## Updates

To update the smart test runner:

```bash
pnpm dev-cli test-runner --help
```

This will download the latest version while preserving your configuration.
