import { describe, it, expect } from 'vitest'
import { runCLI } from '@esteban-url/trailhead-cli/testing'

describe('Advanced CLI Integration', () => {
  it('should display help information', async () => {
    const result = await runCLI(['--help'])
    
    expect(result.success).toBe(true)
    expect(result.value.stdout).toContain('{{description}}')
    expect(result.value.stdout).toContain('init')
    expect(result.value.stdout).toContain('config')
    expect(result.value.stdout).toContain('validate')
  })

  it('should handle unknown commands gracefully', async () => {
    const result = await runCLI(['unknown-command'])
    
    expect(result.success).toBe(false)
    expect(result.error.message).toContain('unknown')
  })

  it('should execute init command', async () => {
    const result = await runCLI(['init', '--force'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })

  it('should execute config command with list option', async () => {
    const result = await runCLI(['config', '--list'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })

  it('should execute config command with validation', async () => {
    const result = await runCLI(['config', '--validate'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })

  it('should execute validate command', async () => {
    const result = await runCLI(['validate'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })

  it('should execute validate with specific target', async () => {
    const result = await runCLI(['validate', '--source'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })

  it('should handle config get operation', async () => {
    const result = await runCLI(['config', '--get', 'name'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })

  it('should handle config set operation', async () => {
    const result = await runCLI(['config', '--set', 'build.minify=true'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })

  it('should handle validate with fix option', async () => {
    const result = await runCLI(['validate', '--fix'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })

  it('should handle validate with custom pattern', async () => {
    const result = await runCLI(['validate', '--pattern', 'src/**/*.ts'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })

  it('should handle command chaining and options', async () => {
    const result = await runCLI(['config', 'build.target'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })

  it('should handle verbose output', async () => {
    const result = await runCLI(['validate', '--verbose'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })

  it('should validate command option formats', async () => {
    const result = await runCLI(['config', '--set', 'invalid-format'])
    
    expect(result.success).toBe(false)
    // Should handle invalid option values gracefully
  })

  it('should handle init with template option', async () => {
    const result = await runCLI(['init', '--template', 'library', '--force'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })

  it('should handle multiple validation targets', async () => {
    const result = await runCLI(['validate', '--source', '--tests'])
    
    expect(result.success).toBe(true)
    expect(result.value.exitCode).toBe(0)
  })
})