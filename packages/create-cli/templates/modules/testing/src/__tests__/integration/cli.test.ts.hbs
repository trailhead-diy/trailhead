import { describe, it, expect } from 'vitest'
import { execFile as execFileCb } from 'child_process'
import { promisify } from 'util'

describe('{{projectName}} CLI Integration', () => {
  const execFile = promisify(execFileCb)

  it('should show version when --version flag is passed', async () => {
    const { stdout } = await execFile('node', ['bin/cli.js', '--version'])
    expect(stdout.trim()).toBe('{{version}}')
  })

  it('should show help when --help flag is passed', async () => {
    const { stdout } = await execFile('node', ['bin/cli.js', '--help'])
    expect(stdout).toContain('{{projectName}}')
    expect(stdout).toContain('{{description}}')
    expect(stdout).toContain('Commands:')
  })

  it('should show help when help command is used', async () => {
    const { stdout } = await execFile('node', ['bin/cli.js', 'help'])
    expect(stdout).toContain('{{projectName}}')
    expect(stdout).toContain('Usage:')
  })

  it('should show version when version command is used', async () => {
    const { stdout } = await execFile('node', ['bin/cli.js', 'version'])
    expect(stdout.trim()).toContain('{{packageName}} version {{version}}')
  })

{{#if features.config}}
  it('should handle config command', async () => {
    const { stdout } = await execFile('node', ['bin/cli.js', 'config'])
    expect(stdout).toContain('--init, --validate, or --show')
  })
{{/if}}
})