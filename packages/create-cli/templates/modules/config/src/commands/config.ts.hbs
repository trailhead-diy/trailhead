import { createCommand } from '@esteban-url/trailhead-cli/command' import { ok, err, createCoreError
} from '@esteban-url/trailhead-cli/core' import { readFileSync, writeFileSync, existsSync } from
'fs' import { resolve } from 'path' import { configSchema, type Config } from
'../lib/config-schema.js' export const configCommand = createCommand({ name: 'config', description:
'Manage application configuration', flags: { init: { type: 'boolean', description: 'Initialize a new
configuration file' }, validate: { type: 'boolean', description: 'Validate existing configuration'
}, show: { type: 'boolean', description: 'Show current configuration' } }, async handler(args) {
const configPath = resolve('config.json') if (args.flags.init) { return initConfig(configPath) } if
(args.flags.validate) { return validateConfig(configPath) } if (args.flags.show) { return
showConfig(configPath) } console.log('Use --init, --validate, or --show to manage configuration')
return ok(undefined) } }) function initConfig(configPath: string) { try { if
(existsSync(configPath)) { console.log('Configuration file already exists. Use --validate to check
it.') return ok(undefined) } const defaultConfig: Config = { name: '{{packageName}}', version: '{{version}}',
environment: 'development', settings: { debug: false, verbose: false } } writeFileSync(configPath,
JSON.stringify(defaultConfig, null, 2)) console.log(`Configuration file created at ${configPath}`)
return ok(undefined) } catch (error) { return err(createCoreError('CONFIG_INIT_FAILED', 'Failed to
initialize configuration', { component: '{{packageName}}', operation: 'initConfig', cause: error,
recoverable: true, severity: 'medium' })) } } function validateConfig(configPath: string) { try { if
(!existsSync(configPath)) { return err(createCoreError('CONFIG_NOT_FOUND', `Configuration file not
found: ${configPath}`, { component: '{{packageName}}', operation: 'validateConfig', details: 'Use
--init to create a configuration file' })) } const configData = readFileSync(configPath, 'utf-8')
const config = JSON.parse(configData) const result = configSchema.safeParse(config) if
(!result.success) { console.error('Configuration validation failed:')
result.error.errors.forEach(error => { console.error(` ${error.path.join('.')}: ${error.message}`)
}) return err(createCoreError('CONFIG_INVALID', 'Configuration validation failed', { component: '{{packageName}}',
operation: 'validateConfig' })) } console.log('Configuration is valid âœ“') return ok(undefined) }
catch (error) { return err(createCoreError('CONFIG_VALIDATION_FAILED', 'Failed to validate
configuration', { component: '{{packageName}}', operation: 'validateConfig', cause: error,
recoverable: true, severity: 'medium' })) } } function showConfig(configPath: string) { try { if
(!existsSync(configPath)) { return err(createCoreError('CONFIG_NOT_FOUND', `Configuration file not
found: ${configPath}`, { component: '{{packageName}}', operation: 'showConfig', details: 'Use --init
to create a configuration file' })) } const configData = readFileSync(configPath, 'utf-8') const
config = JSON.parse(configData) console.log('Current configuration:')
console.log(JSON.stringify(config, null, 2)) return ok(undefined) } catch (error) { return
err(createCoreError('CONFIG_SHOW_FAILED', 'Failed to show configuration', { component: '{{packageName}}',
operation: 'showConfig', cause: error, recoverable: true, severity: 'medium' })) } }