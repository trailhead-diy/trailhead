# Codecov Setup Guide

This guide helps you set up Codecov for the Trailhead monorepo.

## Current Status

The repository is configured to generate and upload coverage reports to Codecov, but you may see this warning in CI:

```
warning - Branch `main` is protected but no token was provided
```

## Setting up Codecov Token

1. **Get your Codecov token:**
   - Go to [codecov.io](https://codecov.io)
   - Sign in with GitHub
   - Navigate to your repository: `esteban-url/trailhead`
   - Copy the upload token from the settings

2. **Add the token to GitHub Secrets:**
   - Go to your repository on GitHub
   - Navigate to Settings → Secrets and variables → Actions
   - Click "New repository secret"
   - Name: `CODECOV_TOKEN`
   - Value: Paste your Codecov token
   - Click "Add secret"

## Coverage Configuration

Coverage is configured at the monorepo level in `tooling/vitest-config/vitest.shared.ts`:

- Coverage provider: v8
- Reporters: text, json, html, lcov (lcov is required for Codecov)
- Coverage is generated by default when running `pnpm test`

## Verifying Coverage Upload

After setting up the token, your CI logs should show successful coverage uploads:

```
info - 2025-07-01 14:34:28,000 -- Process coverage files complete
info - 2025-07-01 14:34:28,001 -- Uploading coverage reports
```

Coverage files are located at:

- `packages/cli/coverage/lcov.info`
- `packages/web-ui/coverage/lcov.info`

## Troubleshooting

If coverage isn't uploading:

1. Ensure tests are running with coverage: `pnpm test` (should include `--coverage`)
2. Check that lcov files exist after tests: `ls packages/*/coverage/lcov.info`
3. Verify the CODECOV_TOKEN secret is set correctly in GitHub
4. Check CI logs for the "Upload coverage to Codecov" step

## Local Testing

To generate coverage locally:

```bash
# Generate coverage for all packages
pnpm test

# Generate coverage for specific package
pnpm test --filter=@trailhead/cli
pnpm test --filter=@trailhead/web-ui
```

Coverage reports will be available in HTML format at:

- `packages/cli/coverage/index.html`
- `packages/web-ui/coverage/index.html`
